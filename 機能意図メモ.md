# 機能・設計意図メモ

## main.py
- アプリケーションのエントリポイント。
- 例外フックで予期せぬエラーをダイアログ表示。
- TagManagerApp（UIメインクラス）を起動し、メインループを開始。

## modules/ui_main.py
- TagManagerAppクラスで全UI構築・イベント処理を担当。
- カテゴリ・タグの表示、編集、出力、テーマ切替、DBバックアップ等の主要機能を統括。
- カテゴリ説明や優先度、UI部品の初期化・管理もここで行う。
- 設計意図：UI/UXの一元管理と、ユーザー操作の一貫性確保。
- 2025/07時点で、異常系・分岐テストの徹底、AttributeError等の防止、E2Eテスト・自動テストの拡充により品質・保守性を大幅強化。

## modules/constants.py
- 各種定数・設定ファイルパス・カテゴリキーワードの管理。
- カテゴリ自動判定やDBファイルパス等、他モジュールから参照される共通情報を集約。
- 設計意図：設定値の一元管理と、ハードコーディング防止。

## modules/tag_manager.py
- タグ情報のDB管理（追加・編集・削除・検索・翻訳・カテゴリ付与・お気に入り等）。
- SQLiteを用いたタグ・最近使ったタグの永続化。
- 設計意図：タグデータの信頼性・一貫性確保と、UI層からの分離。

## modules/dialogs.py
- カテゴリ選択や一括カテゴリ変更など、ユーザー入力用のダイアログUIを提供。
- 設計意図：複雑な入力や確認操作をモーダルダイアログで安全に実装。

## modules/theme_manager.py
- テーマ設定の保存・読込・切替を担当。
- 利用可能なテーマ一覧の提供。
- 設計意図：ユーザーごとのUIテーマカスタマイズを容易にし、設定の永続化を実現。

## modules/__init__.py
- パッケージ初期化用の空ファイル。
- 設計意図：modulesディレクトリをPythonパッケージとして認識させるため。

## tests/test_tag_manager.py
- TagManagerクラスの各種機能（追加・削除・編集・翻訳・カテゴリ・キャッシュ・エクスポート/インポート等）の自動テスト。
- pytestを用い、DBの一時ファイルでテストを実施。
- 設計意図：タグ管理機能の品質保証と、将来のリファクタ時の安全性確保。

---

# コンフィグ・データファイルの設計意図

## resources/config/categories.json
- 各カテゴリ名と、そのカテゴリに属するキーワード一覧を定義。
- 設計意図：タグの自動分類やカテゴリ選択UIの元データとして利用。カテゴリ追加・編集を容易にする。

## resources/config/prompt_structure.json
- 各カテゴリの優先度（priority）、説明文（description）、例（examples）を定義。
- 設計意図：プロンプト出力時の並び順制御や、UIでのカテゴリ説明表示に利用。カテゴリの意味や使い方を明示。

## resources/config/translated_tags.json
- タグ（英語）と日本語訳、お気に入りフラグ、カテゴリ情報のリスト。
- 設計意図：タグ一覧の多言語対応、カテゴリ分け、お気に入り管理のためのデータベース。

## resources/config/negative_tags.json
- ネガティブプロンプト用タグ（英語・日本語訳・カテゴリ等）のリスト。
- 設計意図：生成時に避けたい要素（品質低下・エラー等）を管理し、ネガティブプロンプト出力や自動分類に利用。

## resources/config/tags.json
- タグ名（英語）のみのリスト。
- 設計意図：シンプルなタグ候補リストや補完用データとして利用。

## resources/config/prompts.json
- プロンプトの履歴やテンプレート等を格納するための空配列。
- 設計意図：将来的なプロンプト履歴・テンプレ保存等の拡張用。

## resources/tags.db
- タグ情報を永続化するSQLiteデータベース。
- 設計意図：タグ・カテゴリ・お気に入り等のデータをアプリ全体で一元管理。

## backup/tags_backup_*.db
- タグDBのバックアップファイル。
- 設計意図：データ消失や破損時のリカバリ用。

---

# その他ファイルの設計意図

## images/*.png
- UIやドキュメント用の画像ファイル。
- 設計意図：アプリのアイコンや説明画像として利用。

## resources/icons/プロンプトタグ管理ツール.ico
- アプリケーションのアイコンファイル。
- 設計意図：Windows等でのショートカットやウィンドウ表示用。

## logs/app.log
- アプリケーションのエラーログ。
- 設計意図：例外やエラー発生時の記録・デバッグ用。
- 2025/07時点で、異常系テストやCI/CD自動化と連携し、運用時の不具合検知・追跡を強化。

## run_app.bat
- 仮想環境の自動セットアップ・依存ライブラリインストール・アプリ起動を一括実行するバッチ。
- 設計意図：初回利用者や非エンジニアでも簡単にアプリを起動できるようにする。

## run_tests.bat
- テスト実行用バッチ。
- 設計意図：pytestによる自動テストをワンクリックで実行可能に。
- 2025/07時点で、全テストパス・異常系テストも網羅し、CI/CDやログ運用と連携した品質保証体制を実現。

## requirements.txt
- 必要なPythonパッケージ一覧。
- 設計意図：開発・実行環境の再現性確保。

## theme_settings.json
- 現在選択中のUIテーマ名を保存。
- 設計意図：ユーザーごとのテーマ設定を永続化。

## .gitignore
- Git管理対象外とするファイル・ディレクトリの一覧。
- 設計意図：不要なファイルや機密情報、ビルド生成物等のコミット防止。

## README.md
- プロジェクトの概要・使い方・開発手順・構成を記載。
- 設計意図：利用者・開発者へのドキュメント提供。

## venv/, .venv/, ENV/, env/, virtualenv/
- Python仮想環境ディレクトリ。
- 設計意図：依存パッケージの隔離と、システム環境への影響防止。

## archive/
- 古いデータや一時的な退避ファイル用ディレクトリ。
- 設計意図：不要になったファイルの保管や履歴管理。 